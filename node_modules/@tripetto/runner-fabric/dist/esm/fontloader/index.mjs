import { useState, useRef, useEffect } from "react";
import { FontLoader } from "./loader.mjs";

const useFontLoader = (font, frameRef, fallback) => {
    const [fontFamily, setFontFamily] = useState(() => (font ? (FontLoader.isStandardFont(font) ? font : undefined) : ""));
    const idRef = useRef("");
    const fontRef = useRef("");
    const setRef = useRef(setFontFamily);
    if (!idRef.current) {
        idRef.current = FontLoader.id;
    }
    setRef.current = setFontFamily;
    useEffect(() => {
        if (fontRef.current !== font) {
            fontRef.current = font;
            if (fontFamily !== font) {
                FontLoader.request(idRef, fontRef, frameRef, setRef, fallback);
            }
        }
    });
    return [typeof fontFamily !== "string", fontFamily];
};

export { useFontLoader };
